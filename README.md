# Разработка сервиса Users и связь с Cats

Цель: Научиться строить связи между сущностями, реализовывать обработку ошибок 404/409 для новых ресурсов, изучить основы REST API с композицией данных.

## Описание

Проект использует приложение на базе NestJS с использованием PostgreSQL в качестве базы данных. Для локальной разработки используется Docker и Docker Compose.

## Задание:

1. Создать модуль Users с сущностью `UserEntity`:
    + Поля: `id`, `firstName`, `lastName`, `isActive`.
    + В `UserEntity` должна быть связь один-ко-многим с `CatEntity` (поле cats).

2. В `CatEntity` должно быть добавлено поле owner связанное с `UserEntity`, то есть все кошки должны быть обязательно закреплены за каким-либо пользователем.

3. Доработать `CreateCatDto`, добавив в него ownerId
  
4. В `CatsService`:
    + На этапе создания кошки привязывать её к существующему пользователю.
    + Если идентификатор пользователя неверен, вернуть 404.
  
5. В `UsersController`: 
    + Реализовать эндпоинт GET `/users/:id/cats` для вывода всех кошек, закреплённых за данным пользователем

6. Доработать обработку ошибок для `Users` подобно тому, что было выполнено в первом задании

## Теория

**REST (Representational State Transfer)** — это архитектурный стиль взаимодействия между клиентом и сервером через HTTP. Каждый ресурс (например, "кошка") имеет свой URL и обрабатывается определёнными HTTP-методами:

| Метод | Назначение | Пример |
|-----------|-----------|-----------|
| GET | Получить данные | /cats или /cats/:id |
| POST | Создать ресурс | /cats |
| PATCH | Частично обновить | /cats/:id |
| DELETE | Удалить  ресурс | /cats/:id |

**HTTP-статусы**:

+ 200 OK — успешный запрос.

+ 201 Created — ресурс успешно создан.

+ 204 No Content — ресурс удалён, тело ответа не требуется.

+ 404 Not Found — запрашиваемый ресурс не найден.

+ 409 Conflict — конфликт.

**Основные файлы NestJS-модуля cats:**

1. `cats.controller.ts` - обрабатывает входящие HTTP-запросы и направляет их в сервис. Здесь описаны эндпоинты: GET, POST, PATCH, DELETE.
2. `cats.service.ts` - содержит бизнес-логику и взаимодействие с базой данных. Контроллер вызывает его методы.
3. `cats.module.ts` - описывает модуль NestJS: какие контроллеры, сервисы и сущности подключаются.
4. `dto/create-cat.dto.ts` - DTO (Data Transfer Object) для создания новой кошки. Здесь задаются поля и их валидация.
5. `entities/cat.entity.ts` - описание таблицы в базе данных (@Entity). Содержит поля id, name, age, breed.


## Требования

Перед началом убедитесь, что у вас установлены следующие инструменты:

- [Docker](https://www.docker.com/)
- [Docker Compose](https://docs.docker.com/compose/)

## Запуск приложения локально

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/MikhailovAlexander/construct-tasks.git
   cd construct-tasks
   ```

2. В файле `.env.local` указаны настройки приложения и базы данных.
3. Приложение запускается в докере:
    
    ```bash
    docker-compose -f docker-compose.local.yml --env-file .env.local up -d
    ```

4. Доступ к приложению:
    - Swagger для приложения будет доступно по адресу: http://localhost:3000/api
    - Менеджер базы данных pgAdmin будет доступен по адресу: http://localhost:5050, для входа нужно использовать параметры из файла `.env.local`, а также:
        * Email: admin@local.com
        * Password: admin
    
Для остановки контейнеров выполните:

```bash
docker-compose -f docker-compose.local.yml --env-file .env.local down
```

Для остановки контейнеров и удаления всех данных (volumes) выполните:

```bash
docker-compose -f docker-compose.local.yml --env-file .env.local down -v
```
